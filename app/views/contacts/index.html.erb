<div class="page-header">
  <h1>Contacts</h1>
  <%= link_to "New Contact", new_contact_path, class: "btn btn-primary" %>
</div>

<div class="card" style="margin-bottom: 1.5rem;">
  <%= form_with url: contacts_path, method: :get, local: true, class: "search-filter-form" do |form| %>
    <div style="display: grid; grid-template-columns: 2fr 1fr auto; gap: 1rem; align-items: end;">
      <div class="form-group" style="margin-bottom: 0;">
        <%= form.label :search, "Search Contacts" %>
        <%= form.text_field :search, value: params[:search], placeholder: "Search by name, email, company, or job title...", class: "search-input" %>
      </div>
      <div class="form-group" style="margin-bottom: 0;">
        <%= form.label :company, "Filter by Company" %>
        <%= form.text_field :company, value: params[:company], placeholder: "Company name..." %>
      </div>
      <div style="display: flex; gap: 0.5rem;">
        <%= form.submit "Search", class: "btn btn-primary" %>
        <% if params[:search].present? || params[:company].present? %>
          <%= link_to "Clear", contacts_path, class: "btn btn-secondary" %>
        <% end %>
      </div>
    </div>
  <% end %>
</div>

<% if params[:search].present? || params[:company].present? %>
  <div style="margin-bottom: 1rem; color: var(--gray);">
    <%= pluralize(@contacts.count, 'contact') %> found
    <% if params[:search].present? %>
      for "<strong><%= params[:search] %></strong>"
    <% end %>
  </div>
<% end %>

<% if @contacts.any? %>
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Job Title</th>
          <th>Company</th>
          <th>Demographics</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @contacts.each do |contact| %>
          <tr>
            <td><strong><%= link_to "#{contact.first_name} #{contact.last_name}", contact, style: "color: var(--primary); text-decoration: none;" %></strong></td>
            <td><%= contact.email %></td>
            <td><%= contact.job_title %></td>
            <td><%= contact.company %></td>
            <td>
              <% if contact.age_range.present? || contact.gender.present? || contact.occupation.present? %>
                <div style="font-size: 0.75rem; color: var(--gray);">
                  <% if contact.age_range.present? %>
                    <span>Age: <%= contact.age_range %></span>
                  <% end %>
                  <% if contact.gender.present? %>
                    <span><%= contact.age_range.present? ? ' • ' : '' %>Gender: <%= contact.gender.humanize %></span>
                  <% end %>
                  <% if contact.occupation.present? %>
                    <span><%= (contact.age_range.present? || contact.gender.present?) ? ' • ' : '' %>Occupation: <%= truncate(contact.occupation, length: 20) %></span>
                  <% end %>
                </div>
              <% else %>
                <span style="color: var(--gray); font-size: 0.75rem;">-</span>
              <% end %>
            </td>
            <td>
              <div class="action-links">
                <%= link_to "View", contact %>
                <%= link_to "Edit", edit_contact_path(contact) %>
                <%= link_to "Delete", contact_path(contact), data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to delete '#{contact.first_name} #{contact.last_name}'? This action cannot be undone." }, class: "text-danger" %>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% else %>
  <div class="card empty-state">
    <% if params[:search].present? || params[:company].present? %>
      <h3>No contacts found</h3>
      <p>Try adjusting your search or filter criteria.</p>
      <%= link_to "Clear Filters", contacts_path, class: "btn btn-secondary" %>
    <% else %>
      <h3>No contacts yet</h3>
      <p>Get started by adding your first contact.</p>
      <%= link_to "Add Contact", new_contact_path, class: "btn btn-primary" %>
    <% end %>
  </div>
<% end %>
